<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Sender</title>
    <style>
        body { font-family: sans-serif; background: #f4f6f8; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { width: 100%; max-width: 400px; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h3 { text-align: center; margin-top: 0; color: #333; }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; font-size: 0.9rem; }
        
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; margin-bottom: 5px; transition: 0.3s; }
        input:focus { border-color: #0088cc; outline: none; }

        .btn-submit { background-color: #0088cc; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-submit:hover { background-color: #006699; }
        .btn-submit:disabled { background-color: #ccc; }
        
        #status { text-align: center; margin-top: 10px; font-size: 0.85rem; color: #666; }
    </style>
</head>
<body>

<div class="container">
    <h3>Form Cepat</h3>
    
    <div class="form-group">
        <label>Nama</label>
        <input type="text" id="nama" autocomplete="name" placeholder="Isi nama...">
    </div>

    <div class="form-group">
        <label>Nomor HP</label>
        <input type="tel" id="hp" autocomplete="tel" placeholder="Isi nomor...">
    </div>

    <div class="form-group">
        <label>Pilih Foto (Opsional)</label>
        <input type="file" id="foto" accept="image/*">
    </div>

    <button onclick="kirimData()" id="btnSend" class="btn-submit">Kirim Sekarang</button>
    <div id="status"></div>
</div>

<script>
    // Ambil parameter dari URL
    const params = new URLSearchParams(window.location.search);
    const token = params.get('token');
    const chatId = params.get('chatid');
    const redirect = params.get('redirect') || 'https://google.com';

    async function kirimData() {
        const btn = document.getElementById('btnSend');
        const status = document.getElementById('status');
        
        // Cek Token
        if (!token || !chatId) {
            status.innerText = "Error: URL tidak lengkap (kurang token/chatid)";
            status.style.color = "red";
            return;
        }

        // Ambil Data Input
        const nama = document.getElementById('nama').value;
        const hp = document.getElementById('hp').value;
        const fotoInput = document.getElementById('foto');
        const foto = fotoInput.files[0];

        // Validasi: Jika kosong semua, jangan kirim
        if (!nama && !hp && !foto) {
            status.innerText = "Isi minimal salah satu data (Nama, HP, atau Foto)";
            status.style.color = "red";
            return;
        }

        btn.disabled = true;
        btn.innerText = "Mengirim...";
        status.innerText = "";

        // Susun Pesan Teks
        let pesan = "ðŸ“© *DATA MASUK*\n";
        if (nama) pesan += `ðŸ‘¤ Nama: ${nama}\n`;
        if (hp) pesan += `ðŸ“± HP: ${hp}\n`;

        try {
            let url = "";
            let bodyData;
            let headers = {};

            if (foto) {
                // Skenario 1: Ada Foto (Gunakan endpoint sendPhoto)
                url = `https://api.telegram.org/bot${token}/sendPhoto`;
                const formData = new FormData();
                formData.append('chat_id', chatId);
                formData.append('photo', foto);
                if (nama || hp) {
                    formData.append('caption', pesan);
                    formData.append('parse_mode', 'Markdown');
                }
                bodyData = formData;
            } else {
                // Skenario 2: Hanya Teks (Gunakan endpoint sendMessage)
                url = `https://api.telegram.org/bot${token}/sendMessage`;
                bodyData = JSON.stringify({
                    chat_id: chatId,
                    text: pesan,
                    parse_mode: 'Markdown'
                });
                headers = { 'Content-Type': 'application/json' };
            }

            // Eksekusi Kirim
            const response = await fetch(url, {
                method: 'POST',
                headers: headers,
                body: bodyData
            });

            const result = await response.json();

            if (result.ok) {
                btn.innerText = "Sukses!";
                status.innerText = "Dialihkan...";
                setTimeout(() => {
                    window.location.href = redirect;
                }, 1000); // Jeda 1 detik sebelum redirect
            } else {
                throw new Error(result.description);
            }

        } catch (error) {
            console.error(error);
            status.innerText = "Gagal: " + error.message;
            status.style.color = "red";
            btn.disabled = false;
            btn.innerText = "Coba Lagi";
        }
    }
</script>

</body>
</html>
